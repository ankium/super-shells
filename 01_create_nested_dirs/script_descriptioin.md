# 通过Shell脚本批量生成指定年份以日期格式命名的嵌套文件夹

> 需求：按照YYYY/MM/YYYY-MM-DD的格式，通过Shell脚本批量生成指定年份的嵌套文件夹！

即第一层是年份（如2025），第二层是年份和月份（如2025-01），第三层是具体的日期目录（如2025-01-01）。同时，我们需要考虑闰年的情况，二月的天数会变化。

> 步骤：

1. 接收一个或多个年份作为参数

2. 对于每个年份，创建主目录（年份）

3. 对于每个月份（1-12），创建子目录（YYYY-MM），然后在其中创建该月的每一天的目录（YYYY-MM-DD）

***注意：月份和日期需要格式化为两位数。***

***我们将使用一个函数来判断闰年，以确定二月的天数。***

> 脚本结构：

- 检查参数是否提供

- 定义闰年判断函数

- 遍历每个参数（年份）

- 对于每个年份，创建12个月份目录（在年份目录下）

- 在每个月份目录下，根据该月的天数创建日期目录

> 目录结构示例：

    2025/  
    ├── 2025-01/  
    │   ├── 2025-01-01  
    │   ├── 2025-01-02  
    │   └── ...  
    ├── 2025-02/  
    │   ├── 2025-02-01  
    │   └── ...  
    └── ...

***注意：月份目录名是YYYY-MM，日期目录名是YYYY-MM-DD，且日期目录位于对应的月份目录下。***

## 代码实现：

```bash
#!/bin/bash

# 函数：检查是否为闰年
is_leap_year() {
    local year=$1
    if (( (year % 4 == 0 && year % 100 != 0) || year % 400 == 0 )); then
        return 0  # 是闰年
    else
        return 1  # 不是闰年
    fi
}

# 主逻辑
if [ $# -eq 0 ]; then
    echo "错误：请至少输入一个年份参数"
    echo "用法：$0 <年份1> [年份2] ..."
    exit 1
fi

for year in "$@"; do
    # 验证年份格式（4位数字）
    if ! [[ "$year" =~ ^[0-9]{4}$ ]]; then
        echo "错误：无效年份 '$year'，必须为4位数字"
        continue
    fi

    # 创建年份目录
    mkdir -p "$year"
    
    # 检查闰年并设置二月天数
    if is_leap_year "$year"; then
        days_in_month=(31 29 31 30 31 30 31 31 30 31 30 31)
    else
        days_in_month=(31 28 31 30 31 30 31 31 30 31 30 31)
    fi

    # 遍历12个月份
    for month in {1..12}; do
        # 格式化为两位数的月份
        mm=$(printf "%02d" "$month")
        
        # 创建月份目录 (YYYY-MM)
        month_dir="${year}/${year}-${mm}"
        mkdir -p "$month_dir"

        # 获取当前月份的天数
        days=${days_in_month[$((month-1))]}

        # 创建日期目录 (YYYY-MM-DD)
        for day in $(seq -w 1 "$days"); do
            date_dir="${year}-${mm}-${day}"
            mkdir -p "${month_dir}/${date_dir}"
        done
    done

    echo "已生成 $year 年的目录结构"
done
```

## 使用说明：

1. 将脚本保存为 **create_nested_dirs.sh**

2. 赋予执行权限：

```bash
chmod +x create_nested_dirs.sh
```

3. 运行脚本（支持多个年份参数）：

```bash
./create_nested_dirs.sh 2024 2025
```

## 生成的目录结构示例：

    2025/  
    ├── 2025-01/  
    │   ├── 2025-01-01  
    │   ├── 2025-01-02  
    │   └── ...  
    ├── 2025-02/  
    │   ├── 2025-02-01  
    │   └── ...  
    └── ...（其他月份目录）

## 功能特点：

1. **精确的目录结构：** 严格遵循 **YYYY/YYYY-MM/YYYY-MM-DD** 格式

2. **闰年处理：** 自动识别闰年（二月29天）和非闰年（二月28天）

3. **日期格式化：** 月份和日期自动补零（01-12月，01-31日）

4. **批量处理：** 支持同时生成多个年份的目录结构

5. **错误处理：** 

   - 验证年份格式（必须为4位数字）

   - 友好的错误提示

6. **幂等性：** 重复运行不会报错，已存在的目录会被跳过

## 参数示例：

```bash
# 生成单个年份
./create_nested_dirs.sh 2025

# 生成多个年份
./create_nested_dirs.sh 2023 2024 2025
```

*提示：如果需要指定生成目录的位置，可以在运行脚本前切换到目标目录，或者在脚本开头添加 **cd /your/target/path** 命令。*